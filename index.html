<html>

<head>
    <title>Event Scheduler</title>

        <link rel="stylesheet" type="text/css" href="assets/css/style.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="assets/js/script.js"></script>

      <!----------------------------------------------------->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

      <link href="addTask.css" rel="stylesheet">
      <link href="teststyle.css" rel="stylesheet">
      <link href="assets/css/empForm1.css" rel="stylesheet">

      <script src="jquery.js"></script>
      <script src="addEmp.js"></script>
      <script src="addTask.js"></script>
      <script src="javascript.js"></script>
      <script src="displayTask.js"></script>

      <!-- Drag to scroll table script (Open Source javascript) -->
      <script type="text/javascript" src="https://cdn.rawgit.com/asvd/dragscroll/master/dragscroll.js"></script>

      <script>
        function scrollPosSides(){
          var rightScrollPos = document.getElementById("table-scroll-tasks").scrollTop;
          document.getElementById("table-scroll-employees").scrollTop = rightScrollPos;
          var bottomScrollPos = document.getElementById("table-scroll-tasks").scrollLeft;
          document.getElementById("table-scroll-days").scrollLeft = bottomScrollPos;
        }
      </script>

      <!-- Drag to scroll table script (Open Source javascript) -->
      <script type="text/javascript" src="https://cdn.rawgit.com/asvd/dragscroll/master/dragscroll.js"></script>


      <!------BootStrap----->


</head>

<body>

    <div id="mainContainer">

        <div id="topContainer">

            <div id="navBarContainer">
                <nav class="navBar">

                    <span role="link" tabindex="0" class="logo">
			                     <img src="assets/images/icons/head_emerald.png">
		                </span>



                    <div class="group">
                        <div class="navItem">
                            <span role="link" tabindex="0" onclick="document.getElementById('addEmployee').style.display='inline-block'" class="navItemLink">Add Employee</span>
                        </div>

                        <div class="navItem">
                            <span role="link" tabindex="0" onclick="document.getElementById('addTask').style.display='inline-block'" class="navItemLink">Add Task</span>
                        </div>


                    </div>

                </nav>
            </div>

            <div id="mainViewContainer">
                <div id="mainContent">
                    <div class="gridViewContainer">
                      <h2 align="center">Scheduling Calendar</h2>

                      <script>
                        var sysDate = new Date();
                        var sysDay = new Date();
                        var sysMonth = new Date();
                        var dayCount = sysDay.getDay();
                        var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                        let employee;
                        let typeofKey;
                        let x = 1;
                        let y = 0;
                        var drawTable = '<table id = wholeTable>';
                        drawTable += "<thead>";
                        drawTable += "<tr>";
                        drawTable += "<th style='color:white;'>Employee Name</th>";



                        let today = new Date();
                        let dd = today.getDate();
                        let mm = today.getMonth()+1; //January is 0!
                        let yyyy = today.getFullYear();

                        let oneWeekAhead = new Date();
                        let nextWeek = today.getDate() + 10;


                        if(dd<10 || nextWeek <10) {
                            dd = '0'+dd
                            nextWeek = '0' + nextWeek;
                        }

                        if(mm<10) {
                            mm = '0'+mm
                        }

                        let edate = yyyy + mm + nextWeek;

                        console.log(edate);


                        /* Finds the logged earliest and latest dates */
                        //let startDate = 20180501;
                        let startDate  = yyyy +  mm + dd;
                        let endDate = parseInt(edate);
                        let startDateN = 20180501;
                        let endDateN = 20180531;
                        if( localStorage.length > 0){
                        for (var key in localStorage) {
                          typeofKey = (typeof localStorage[key]);
                          if (typeofKey == 'string' || typeofKey instanceof String ){
                            emp1 = JSON.parse(localStorage.getItem(key));
                            if ("Task" in emp1) {
                              for (let i = 0; i < emp1.Task.length; i++) {
                                startDateN = parseInt(emp1.Task[i]['Task Start Date'].substr(0,4) + emp1.Task[i]['Task Start Date'].substr(5,2) + emp1.Task[i]['Task Start Date'].substr(8,2));
                                endDateN = parseInt(emp1.Task[i]['Task End Date'].substr(0,4) + emp1.Task[i]['Task End Date'].substr(5,2) + emp1.Task[i]['Task End Date'].substr(8,2));
                                if(endDateN > endDate) {
                                  endDate = endDateN;
                                }
                                if(startDateN < startDate) {
                                  startDate = startDateN;
                                }
                              }
                            }
                          }
                        }
                      }
                        let numStr = null;
                        let numStrDay = null;
                        let finalDay = null;
                        let finalDayF = null;
                        let colCount = 0;
                        for (let i = startDate; i <= endDate +1; i++) {
                          numStr = (i.toString()).substr(4,2);
                          numStrDay = (i.toString()).substr(6,2);
                          if(numStr == '09' || numStr == '04' || numStr == '06' || numStr == '11') {
                            if(numStrDay == '30') {
                              i += 70;
                            }
                            else {
                              finalDay = i.toString()
                              finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
                              drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
                              colCount++;
                            }
                          }
                          else if(numStr == '01' || numStr == '03' || numStr == '05' || numStr == '07' || numStr == '08' || numStr == '10' || numStr == '12') {
                            if(numStrDay == '31') {
                              i += 69;
                            }
                            else {
                              finalDay = i.toString()
                              finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
                              drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
                              colCount++;
                            }
                          }
                          else if(numStr == '02') {
                            if(numStrDay == '28') {
                              i += 72;
                            }
                            else {
                              finalDay = i.toString()
                              finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
                              drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
                              colCount++;
                            }
                          }
                          else {
                            finalDay = i.toString()
                            finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
                            drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
                            colCount++;
                          }
                          x++;
                        }
                        drawTable += "</tr>";
                        drawTable += "</thead>";
                        drawTable += '<tbody class="dragscroll">';
                        drawTable += '<tr>';
                        //counters for the employee and date rows/col
                        x=0;
                        y=1;
                        // counter for the main table
                        let z =1;
                        for (var key in localStorage) {
                          typeofKey = (typeof localStorage[key]);
                          //cols of the employee names
                          if(typeofKey == 'string' || typeofKey instanceof String ){
                            employee = JSON.parse(localStorage.getItem(key));
                            drawTable += "<td class = employ id =emp" + x + '-' + y + ">" + employee['Employee Name'] + "</td>";
                            // rows and cols of the main table and date
                            for (let j = 0; j < colCount; j++) {
                              drawTable += "<td id =" + z + '-' + y + "></td>";
                              z++;
                            }
                            // set z to one to start the main tables x at 1 for off by one error
                            z=1;
                            //reset x for each row
                            x=0;
                          drawTable += '</tr>';
                          y++;
                        }

                      }
                     drawTable += '<tr>';
                     var noRows = 10 - localStorage.length;
                      for(; noRows >= 0; noRows--){

                        drawTable += "<td class = employ id =emp" + x + '-' + y + ">" + "" + "</td>";
                        // rows and cols of the main table and date
                        for (let j = 0; j < colCount; j++) {
                          drawTable += "<td id =" + z + '-' + y + "></td>";
                          z++;
                        }
                        // set z to one to start the main tables x at 1 for off by one error
                        z=1;
                        //reset x for each row
                        x=0;
                      drawTable += '</tr>';
                      y++;

                      }
                      drawTable += "</tbody>";
                      drawTable += "</table>";
                      document.write(drawTable);
                    </script>

                      <div id="addEmployee" class="modal">
                          <!--form addEmployee-->
                      <div id="task-messages">
                          <form class="new_alignment_type" id="new_alignment_type" accept-charset="UTF-8" method="POST" name="empForm" onsubmit="return create_employee(this);">

                              <div class="container">
                                <div style="margin-top:50px;" class="col-md-4 col-md-offset-4 col-sm-7 col-sm-offset-2">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">

                                            <div class="panel-title"><strong>Add Employee</strong>
                                                <div class="pull-right">
                                                    <div style="margin-top: -6px">

                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div style="padding-top:30px" class="panel-body">
                                          <div id="labelinputc" class="labelinputclass">
                                            <div class="row">
                                                <div class="col-md-9">
                                                    <label for="alignment_type_alignment_type">Employee Name:</label>
                                                    <input class="form-control" type="text" name="empName" required>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-9">
                                                    <label for="alignment_type_abbrev">Employee ID:</label>
                                                    <input class="form-control" type="text" name="empId" required>
                                                </div>

                                            </div>
                                          </div>
                                            <br>
                                            <div id="buttonget">
                                              <div style="float: left;">
                                                <button id="submitbtn" type="submit" class="btn btn-success">Submit</button>
                                              </div>
                                              <div style="float: right;">
                                                <button type="button" onclick="document.getElementById('addEmployee').style.display='none'" class="btn btn-danger" >Cancel</button>
                                              </div>
                                        </div>
                                      </div>
                                    </div>
                                </div>
                            </div>
                          </form>
                          </div>
                        </div>

                      <div id="addTask" class="modal">
                        <!--form addTask-->
                        <div id="task-messages">
                              <form class="new_alignment_type" id="new_alignment_type" accept-charset="UTF-8" method="POST" name="taskForm" onsubmit="return submit_json(this);">

                                <div class="container">
                                  <div style="margin-top:50px;" class="col-md-4 col-md-offset-4 col-sm-7 col-sm-offset-2">
                                      <div class="panel panel-default">
                                          <div class="panel-heading">

                                              <div class="panel-title"><strong>Add Task</strong>
                                                  <div class="pull-right">
                                                      <div style="margin-top: -6px">

                                                      </div>
                                                  </div>
                                              </div>

                                          </div>
                                          <div style="padding-top:30px" class="panel-body">
                                            <div id="labelinputc" class="labelinputclass">
                                              <div class="row">
                                                  <div class="col-md-9">
                                                      <label for="alignment_type_alignment_type">Employee to add Task to:</label>
                                                      <input class="form-control" type="text" name="emp1Name" required>
                                                  </div>
                                              </div>

                                              <div class="row">
                                                  <div class="col-md-9">
                                                      <label for="alignment_type_abbrev">Task Name:</label>
                                                      <input class="form-control" type="text" name="tskname" required>
                                                  </div>
                                              </div>

                                              <div class="row">
                                                  <div class="col-md-9">
                                                      <label for="alignment_type_abbrev">Task Description:</label>
                                                      <input class="form-control" type="text" name="tskdes" required>
                                                  </div>
                                              </div>


                                              <div class="datefields">
                                                <div class="field-wrap1">
                                                  <div class="row">
                                                      <div class="col-md-9">
                                                          <label for="alignment_type_abbrev">Start Date:</label>
                                                          <input class="form-control" type="date" name="tskstart" required>
                                                      </div>
                                                  </div>

                                                  <div class="row">
                                                      <div class="col-md-9">
                                                          <label for="alignment_type_abbrev">End Date:</label>
                                                          <input class="form-control" type="date" name="tskstart" required>
                                                      </div>
                                                  </div>
                                                </div>
                                              </div>

                                              <div class="row">
                                                  <div class="col-md-9">
                                                      <label for="alignment_type_abbrev">Task Status:</label>
                                                      <input class="form-control" type="text" name="tskStatus" required>
                                                  </div>
                                              </div>

                                            </div>
                                              <br>
                                            <div id="buttonget">
                                                <div style="float: left;">
                                                  <button id="submitbtn" type="submit" class="btn btn-success">Submit</button>
                                                </div>
                                                <div style="float: right;">
                                                  <button type="button" onclick="document.getElementById('addTask').style.display='none'" class="btn btn-danger" >Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                      </div>
                                  </div>
                              </div>
                              </form>
                          </div>
                      </div>

                        <script>
                          // Get the modal
                          var modal = document.getElementById('addEmployee');
                          // When the user clicks anywhere outside of the modal, close it
                          window.onclick = function(event) {
                            if (event.target == modal) {
                                modal.style.display = "none";
                            }
                          }
                        </script>

                        <!-- <pre id=output></pre> -->

                        <script> console.log() </script>



                    </div>
                </div>
          </div>

        </div>



</body>

</html>
