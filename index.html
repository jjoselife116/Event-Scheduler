<!-- https://datatables.net/ -->

<!DOCTYPE html>
<html>
  <head>
    <title> Scheduling Calendar </title>

    <link href="addTask.css" rel="stylesheet">
    <link href="teststyle.css" rel="stylesheet">

    <script src="jquery.js"></script>
    <script src="addEmp.js"></script>
    <script src="addTask.js"></script>
    <script src="javascript.js"></script>
    <script src="displayTask.js"></script>
  </head>

  <body>
    <h2 align="center">Scheduling Calendar</h2>

    <script>
      var sysDate = new Date();
      var sysDay = new Date();
      var sysMonth = new Date();
      var dayCount = sysDay.getDay();
      var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

      let employee;
      let typeofKey;
      let x = 1;
      let y = 0;
      var drawTable = '<table id = wholeTable>';
      drawTable += "<thead>";
      drawTable += "<tr>";
      drawTable += "<th style='color:white;'>Employee Name</th>";

      /* Finds the logged earliest and latest dates */
      let startDate = 10000000000000000000;
      let endDate = 0;
      let startDateN = 0;
      let endDateN = 0;
      for (var key in localStorage) {
        typeofKey = (typeof localStorage[key]);
        if (typeofKey == 'string' || typeofKey instanceof String ){
          emp1 = JSON.parse(localStorage.getItem(key));
          if ("Task" in emp1) {
            for (let i = 0; i < emp1.Task.length; i++) {
              startDateN = parseInt(emp1.Task[i]['Task Start Date'].substr(0,4) + emp1.Task[i]['Task Start Date'].substr(5,2) + emp1.Task[i]['Task Start Date'].substr(8,2));
              endDateN = parseInt(emp1.Task[i]['Task End Date'].substr(0,4) + emp1.Task[i]['Task End Date'].substr(5,2) + emp1.Task[i]['Task End Date'].substr(8,2));
              if(endDateN > endDate) {
                endDate = endDateN;
              }
              if(startDateN < startDate) {
                startDate = startDateN;
              }
            }
          }
        }
      }

      let numStr = null;
      let numStrDay = null;
      let finalDay = null;
      let finalDayF = null;
      let colCount = 0;
      for (let i = startDate; i <= endDate; i++) {
        numStr = (i.toString()).substr(4,2);
        numStrDay = (i.toString()).substr(6,2);
        if(numStr == '09' || numStr == '04' || numStr == '06' || numStr == '11') {
          if(numStrDay == '30') {
            i += 70;
          }
          else {
            finalDay = i.toString()
            finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
            drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
            colCount++;
          }
        }
        else if(numStr == '01' || numStr == '03' || numStr == '05' || numStr == '07' || numStr == '08' || numStr == '10' || numStr == '12') {
          if(numStrDay == '31') {
            i += 69;
          }
          else {
            finalDay = i.toString()
            finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
            drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
            colCount++;
          }
        }
        else if(numStr == '02') {
          if(numStrDay == '28') {
            i += 72;
          }
          else {
            finalDay = i.toString()
            finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
            drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
            colCount++;
          }
        }
        else {
          finalDay = i.toString()
          finalDayF = (finalDay.substr(0,4)) + "-" + (finalDay.substr(4,2)) + "-" + (finalDay.substr(6,2));
          drawTable += "<th class = days id = days" + x + '-' + y + ">" + finalDayF + "</th>";
          colCount++;
        }
        x++;
      }

      drawTable += "</tr>";
      drawTable += "</thead>";
      drawTable += '<tbody class="dragscroll">';

      drawTable += '<tr>';
      //counters for the employee and date rows/col
      x=0;
      y=1;

      // counter for the main table
      let z =1;
      for (var key in localStorage) {
        typeofKey = (typeof localStorage[key]);

        //cols of the employee names
        if(typeofKey == 'string' || typeofKey instanceof String ){
          employee = JSON.parse(localStorage.getItem(key));
          drawTable += "<td class = employ id =emp" + x + '-' + y + ">" + employee['Employee Name'] + "</td>";

          // rows and cols of the main table and date
          for (let j = 0; j < colCount; j++) {
            drawTable += "<td id =" + z + '-' + y + "></td>";
            z++;
          }
          // set z to one to start the main tables x at 1 for off by one error
          z=1;
          //reset x for each row
          x=0;

        drawTable += '</tr>';
        y++;
      }
    }

    drawTable += "</tbody>";
    drawTable += "</table>";
    document.write(drawTable);
  </script>

    <div id="addEmployee" class="modal">
        <!--form addEmployee-->
    <div id="task-messages">
        <form class="modal-content animate" method="POST" name="empForm" onsubmit="return create_employee(this);">

          <div class="container">
            <div class="imgcontainer">
              <span onclick="document.getElementById('addEmployee').style.display='none'" class="close" title="Close Modal">&times;</span>
            </div>
            <label for="empName"><b>Employee Name:</b></label>
            <input type="text" name="empName" required><br>

            <label for="tskname"><b>Employee Id:</b></label>
            <input type="text" name="empId" required><br>

            <button id="submitbtn" type="submit">Submit</button>
            <button type="button" onclick="document.getElementById('addEmployee').style.display='none'; " class="cancelbtn">Cancel</button>
          </div>

          <div class="container" style="background-color:#f1f1f1">

          </div>
        </form>
        </div>
      </div>

    <div id="addTask" class="modal">
      <!--form addTask-->
      <div id="task-messages">
            <form class="modal-content animate" method="POST" name="taskForm" onsubmit="return submit_json(this);">

              <div class="container">
                <div class="imgcontainer">
                  <span onclick="document.getElementById('addTask').style.display='none'" class="close" title="Close Modal">&times;</span>
                </div>

                <label for="emplName"><b>Employee to add Task to:</b></label>
                <input typr="text" name="emplName" required><br>
                <label for="tskname"><b>Task Name:</b></label>
                <input type="text" name="tskname" required><br>

                <label for="tskdes"><b>Task Descripts:</b></label><br>
                <textarea rows="4" cols="50" name="tskdes">
                  Enter Task Descripts here...</textarea><br>

                <label for="tskstart"><b>Task Start Date:</b></label>
                <input type="date" name="tskstart" required><br>

                <label for="tskend"><b>Task End Date:</b></label>
                <input type="date"  name="tskend" required><br>

                <label for="tskStatus"><b>Task Status:</b></label>
                <input type="text" name="tskStatus" required><br>

                <button id="submitbtn" type="submit">Submit</button>
                <button type="button" onclick="document.getElementById('addTask').style.display='none'" class="cancelbtn">Cancel</button>
              </div>

              <div class="container" style="background-color:#f1f1f1">

              </div>
            </form>
        </div>
    </div>

      <script>
        // Get the modal
        var modal = document.getElementById('addEmployee');
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
        }
      </script>

      <pre id=output></pre>

      <script> console.log() </script>

      <!--Add Task button-->
      <div class="employee-mod-btn">
        <button type="button" class="add-Emp-button" onclick="document.getElementById('addEmployee').style.display='block'">Add Employee</button>
        <button type="button" class="ec-today-button ec-button ec-state-default ec-corner-left ec-corner-right " onclick="document.getElementById('addTask').style.display='block'">Add Task
        </button>
      </div>

  </body>

</html>
